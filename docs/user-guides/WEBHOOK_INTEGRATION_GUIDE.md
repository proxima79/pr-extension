# üîó Webhook Integration Guide - Smart PR Creator

## Overview

Webhooks allow the Smart PR Creator extension to send real-time notifications to external services when pull requests are created, updated, or completed. This enables powerful integrations with team tools and automation workflows.

## üéØ Use Cases

### **1. Team Notifications**

- **Slack Integration**: Notify team channels when PRs are created
- **Microsoft Teams**: Send formatted PR announcements
- **Discord**: Update development channels with PR activity
- **Email Notifications**: Send stakeholder updates

### **2. Project Management Integration**

- **Jira**: Automatically update ticket status when PRs are created
- **Azure DevOps Work Items**: Link PRs to work items automatically
- **Trello**: Move cards to "Under Review" when PR is created
- **Linear**: Update issue status and add PR links

### **3. CI/CD Automation**

- **Jenkins**: Trigger additional build pipelines
- **GitHub Actions**: Start custom workflows based on PR metadata
- **Azure Pipelines**: Initiate code quality checks
- **Custom Deployment**: Trigger staging environment updates

### **4. Code Quality & Security**

- **SonarQube**: Initiate code analysis for PR branches
- **CodeClimate**: Trigger code quality assessments
- **Snyk**: Start security vulnerability scans
- **Custom Linting**: Run team-specific code quality checks

### **5. Documentation & Analytics**

- **Confluence**: Auto-create release notes from PR descriptions
- **Custom Analytics**: Track PR creation patterns and AI usage
- **Team Dashboards**: Update development velocity metrics
- **Knowledge Base**: Auto-update documentation with changes

## üîß Technical Implementation

### **Webhook Service Architecture**

```typescript
interface WebhookConfig {
  url: string;
  secret?: string;
  events: WebhookEvent[];
  headers?: Record<string, string>;
  retryAttempts: number;
  timeout: number;
}

interface WebhookEvent {
  type: "pr_created" | "pr_updated" | "pr_merged" | "pr_closed";
  enabled: boolean;
  filter?: {
    repositories?: string[];
    branches?: string[];
    authors?: string[];
  };
}

class WebhookService {
  private webhooks: WebhookConfig[] = [];

  async sendWebhook(
    event: WebhookEvent,
    payload: WebhookPayload
  ): Promise<void> {
    // Implementation for sending webhooks with retry logic
  }

  async registerWebhook(config: WebhookConfig): Promise<void> {
    // Add webhook to configuration
  }

  async testWebhook(url: string): Promise<boolean> {
    // Test webhook connectivity
  }
}
```

### **Enhanced PR Creation Flow**

```typescript
// In azureCliService.ts - after PR creation
export class AzureCliService {
  private webhookService = new WebhookService();

  async createPullRequest(
    repoInfo: AzureRepoInfo,
    options: AzurePROptions,
    workspaceFolder: string
  ): Promise<AzurePRResult> {
    // ... existing PR creation logic ...

    const prResult = await this.performPRCreation(repoInfo, options);

    // Send webhook notification
    await this.sendPRCreatedWebhook(repoInfo, options, prResult);

    return prResult;
  }

  private async sendPRCreatedWebhook(
    repoInfo: AzureRepoInfo,
    options: AzurePROptions,
    result: AzurePRResult
  ): Promise<void> {
    const payload: WebhookPayload = {
      event: "pr_created",
      pullRequest: {
        id: result.pullRequestId,
        title: options.title,
        description: options.description,
        url: result.url,
        author: await this.getCurrentUser(),
        sourceBranch: options.sourceBranch,
        targetBranch: options.targetBranch,
        repository: `${repoInfo.organization}/${repoInfo.project}/${repoInfo.repository}`,
        aiGenerated: options.description.includes(
          "Generated by Smart PR Creator"
        ),
        modelUsed: this.getUsedAIModel(),
      },
      timestamp: new Date().toISOString(),
      metadata: {
        extensionVersion: this.getExtensionVersion(),
        workspaceFolder: path.basename(workspaceFolder),
        commits: options.commits?.length || 0,
        filesChanged: options.changedFiles?.length || 0,
      },
    };

    await this.webhookService.sendWebhook("pr_created", payload);
  }
}
```

## ‚öôÔ∏è Configuration

### **VS Code Settings**

```json
{
  "smartPrCreator.webhooks": {
    "enabled": true,
    "endpoints": [
      {
        "name": "Slack Notifications",
        "url": "https://hooks.slack.com/services/YOUR/SLACK/WEBHOOK",
        "events": ["pr_created", "pr_merged"],
        "headers": {
          "Content-Type": "application/json"
        }
      },
      {
        "name": "Team Dashboard",
        "url": "https://your-dashboard.com/api/webhooks/pr-events",
        "secret": "your-webhook-secret",
        "events": ["pr_created", "pr_updated"],
        "retryAttempts": 3
      }
    ]
  }
}
```

### **Webhook Management Commands**

```typescript
// New commands to add to package.json
{
    "commands": [
        {
            "command": "smart-pr-creator.configureWebhooks",
            "title": "Configure Webhooks",
            "category": "Smart PR Creator"
        },
        {
            "command": "smart-pr-creator.testWebhook",
            "title": "Test Webhook Connection",
            "category": "Smart PR Creator"
        },
        {
            "command": "smart-pr-creator.webhookHistory",
            "title": "View Webhook History",
            "category": "Smart PR Creator"
        }
    ]
}
```

## üìã Common Webhook Formats

### **Slack Webhook**

```json
{
  "text": "New Pull Request Created",
  "attachments": [
    {
      "color": "good",
      "fields": [
        {
          "title": "PR Title",
          "value": "Add GitHub Copilot integration",
          "short": false
        },
        {
          "title": "Repository",
          "value": "myorg/myproject/myrepo",
          "short": true
        },
        {
          "title": "Author",
          "value": "john.doe@company.com",
          "short": true
        },
        {
          "title": "AI Generated",
          "value": "Yes (GPT-4o)",
          "short": true
        }
      ],
      "actions": [
        {
          "type": "button",
          "text": "View PR",
          "url": "https://dev.azure.com/org/project/_git/repo/pullrequest/123"
        }
      ]
    }
  ]
}
```

### **Microsoft Teams Webhook**

```json
{
  "@type": "MessageCard",
  "@context": "http://schema.org/extensions",
  "themeColor": "0076D7",
  "summary": "New Pull Request",
  "sections": [
    {
      "activityTitle": "Pull Request Created",
      "activitySubtitle": "myorg/myproject/myrepo",
      "facts": [
        {
          "name": "Title",
          "value": "Add GitHub Copilot integration"
        },
        {
          "name": "Author",
          "value": "john.doe@company.com"
        },
        {
          "name": "AI Model",
          "value": "GPT-4o"
        }
      ]
    }
  ],
  "potentialAction": [
    {
      "@type": "OpenUri",
      "name": "View Pull Request",
      "targets": [
        {
          "os": "default",
          "uri": "https://dev.azure.com/org/project/_git/repo/pullrequest/123"
        }
      ]
    }
  ]
}
```

## üîí Security Considerations

### **Webhook Security**

```typescript
class SecureWebhookService {
  private generateSignature(payload: string, secret: string): string {
    return crypto.createHmac("sha256", secret).update(payload).digest("hex");
  }

  private async sendSecureWebhook(
    config: WebhookConfig,
    payload: WebhookPayload
  ): Promise<void> {
    const body = JSON.stringify(payload);
    const headers: Record<string, string> = {
      "Content-Type": "application/json",
      "User-Agent": "Smart-PR-Creator-Extension",
      ...config.headers,
    };

    if (config.secret) {
      headers["X-Hub-Signature-256"] = `sha256=${this.generateSignature(
        body,
        config.secret
      )}`;
    }

    await fetch(config.url, {
      method: "POST",
      headers,
      body,
      timeout: config.timeout || 10000,
    });
  }
}
```

## üß™ Testing Webhooks

### **Test Webhook Command**

```typescript
async function testWebhook() {
  const webhookUrl = await vscode.window.showInputBox({
    prompt: "Enter webhook URL to test",
    placeHolder: "https://your-webhook-endpoint.com/webhook",
  });

  if (!webhookUrl) return;

  const testPayload: WebhookPayload = {
    event: "pr_created",
    pullRequest: {
      id: "test-123",
      title: "Test Pull Request",
      description: "This is a test webhook from Smart PR Creator",
      url: "https://example.com/test-pr",
      author: "test.user@example.com",
      sourceBranch: "feature/test",
      targetBranch: "main",
      repository: "test/test/test",
      aiGenerated: true,
      modelUsed: "GPT-4o",
    },
    timestamp: new Date().toISOString(),
    metadata: {
      extensionVersion: "1.0.0",
      workspaceFolder: "test-workspace",
      commits: 3,
      filesChanged: 5,
    },
  };

  try {
    await webhookService.sendWebhook("pr_created", testPayload);
    vscode.window.showInformationMessage("‚úÖ Webhook test successful!");
  } catch (error) {
    vscode.window.showErrorMessage(`‚ùå Webhook test failed: ${error.message}`);
  }
}
```

## üìä Analytics & Monitoring

### **Webhook Analytics**

```typescript
interface WebhookMetrics {
  totalSent: number;
  successRate: number;
  averageResponseTime: number;
  failureReasons: Record<string, number>;
  lastSent: Date;
  popularEvents: Record<string, number>;
}

class WebhookAnalytics {
  async getMetrics(): Promise<WebhookMetrics> {
    // Implementation for webhook analytics
  }

  async logWebhookAttempt(
    url: string,
    success: boolean,
    responseTime: number,
    error?: string
  ): Promise<void> {
    // Log webhook attempt for analytics
  }
}
```

## üöÄ Getting Started

### **1. Enable Webhooks**

```bash
# Add to VS Code settings.json
{
    "smartPrCreator.webhooks.enabled": true
}
```

### **2. Configure First Webhook**

1. Open Command Palette (`Ctrl+Shift+P`)
2. Run `Smart PR Creator: Configure Webhooks`
3. Add your webhook URL and select events
4. Test the connection

### **3. Monitor Webhook Activity**

1. Use `Smart PR Creator: View Webhook History`
2. Check success rates and response times
3. Debug failed webhook deliveries

---

This webhook integration would transform your Smart PR Creator from a standalone tool into a powerful hub for team collaboration and automation workflows!
